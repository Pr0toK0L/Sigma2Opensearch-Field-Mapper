id: 25b9c01c-350d-4b95-bed1-836d04a4f324
logsource:
  product: linux
title: Potential curl CVE-2023-38545 Exploitation
description: >-
  Detects potential exploitation of curl CVE-2023-38545 by monitoring for
  vulnerable command line arguments in conjunction with an unusual command line
  length. A flaw in curl version <= 8.3 makes curl vulnerable to a heap based
  buffer overflow during the SOCKS5 proxy handshake. Upgrade to curl version >=
  8.4 to patch this vulnerability. This exploit can be executed with and without
  the use of environment variables. For increased visibility, enable the
  collection of http_proxy, HTTPS_PROXY and ALL_PROXY environment variables
  based on the instructions provided in the setup guide of this rule.
tags:
  - attack.execution
  - attack.TA0002
  - attack.T1203
falsepositives:
  - >-
    There is a potential for false positives if the curl command is used for
    legitimate purposes with the specified arguments and environment variables.
    It is important to investigate any alerts generated by this rule to
    determine if they are indicative of malicious activity or part of legitimate
    usage.
level: medium
status: experimental
references: []
author: hoang.nguyen
detection:
  condition: >-
    selection1 and (selection2 or selection3) and not exclusion1 and not
    exclusion2
  selection1:
    host.os.type:
      - linux
    event.type:
      - start
    event.action|contains:
      - exec
      - executed
    process.name:
      - curl
  selection2:
    process.args|contains:
      - '--socks5-hostname'
      - '--proxy'
      - '--preproxy'
      - socks5
  selection3:
    process.env_vars|contains:
      - 'http_proxy=socks5h://*'
      - 'HTTPS_PROXY=socks5h://*'
      - 'ALL_PROXY=socks5h://*'
  exclusion1:
    process.name|contains:
      - cf-agent
      - agent-run
      - agent-check
      - rudder
      - agent-inventory
      - cf-execd
  exclusion2:
    process.args:
      - /opt/rudder/bin/curl
